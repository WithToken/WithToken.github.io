<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0" />






<meta name="description" content="Masonry是一个轻量级的布局框架，拥有自己的描述语法，采用更优雅的链式语法封装自动布局，简洁明了，并具有高可读性。而且同时支持iOS和macOS。">
<meta property="og:type" content="article">
<meta property="og:title" content="Masonry 源码阅读">
<meta property="og:url" content="http://yoursite.com/2017/04/01/2017-2-11/index.html">
<meta property="og:site_name" content="guodajiang's blog">
<meta property="og:description" content="Masonry是一个轻量级的布局框架，拥有自己的描述语法，采用更优雅的链式语法封装自动布局，简洁明了，并具有高可读性。而且同时支持iOS和macOS。">
<meta property="og:updated_time" content="2017-04-19T14:34:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Masonry 源码阅读">
<meta name="twitter:description" content="Masonry是一个轻量级的布局框架，拥有自己的描述语法，采用更优雅的链式语法封装自动布局，简洁明了，并具有高可读性。而且同时支持iOS和macOS。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/04/01/2017-2-11/"/>





  <title> Masonry 源码阅读 | guodajiang's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">guodajiang's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">guodajiang's blog</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-iOS " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/01/2017-2-11/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="guodajiang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="guodajiang's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="guodajiang's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Masonry 源码阅读
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-01T21:06:11+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://github.com/SnapKit/Masonry" target="_blank" rel="external">Masonry</a>是一个轻量级的布局框架，拥有自己的描述语法，采用更优雅的链式语法封装自动布局，简洁明了，并具有高可读性。而且同时支持iOS和macOS。</p>
<a id="more"></a>
<h1 id="Masonry工具的结构及各个类的大概的作用。"><a href="#Masonry工具的结构及各个类的大概的作用。" class="headerlink" title="Masonry工具的结构及各个类的大概的作用。"></a><code>Masonry</code>工具的结构及各个类的大概的作用。</h1><h2 id="1-MASViewAttribute-先看下类结构。"><a href="#1-MASViewAttribute-先看下类结构。" class="headerlink" title="1.MASViewAttribute 先看下类结构。"></a>1.<code>MASViewAttribute</code> 先看下类结构。</h2><p> 有三个属性和三个方法。下面是初始化方法的调用顺序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (id)initWithView:(MAS_VIEW *)view layoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    self = [self initWithView:view item:view layoutAttribute:layoutAttribute];</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (id)initWithView:(MAS_VIEW *)view item:(id)item layoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (!self) return nil;</div><div class="line">    </div><div class="line">    _view = view;</div><div class="line">    _item = item;</div><div class="line">    _layoutAttribute = layoutAttribute;</div><div class="line">    </div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>通过传入的参数可以得知这是对<code>NSLayoutAttribute</code>的封装。<br>该方法传入三个值：<code>view</code>，<code>item</code>，<code>layoutAttribute</code>。后面会用到这几个属性。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (BOOL)isSizeAttribute &#123;</div><div class="line">    return self.layoutAttribute == NSLayoutAttributeWidth</div><div class="line">        || self.layoutAttribute == NSLayoutAttributeHeight;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>isSizeAttribute</code>方法，该方法用来判断<code>MASViewAttribute</code>类中的<code>layoutAttribute</code>属性是否是<code>NSLayoutAttributeWidth</code>或者<code>NSLayoutAttributeHeight</code>，如果是<code>Width</code>或者<code>Height</code>的话，那么约束就添加到当前View上，而不是添加在父视图上。</li>
</ul>
<h2 id="2-MASCompositeConstraint-是MASConstraint的集合"><a href="#2-MASCompositeConstraint-是MASConstraint的集合" class="headerlink" title="2.MASCompositeConstraint 是MASConstraint的集合"></a>2.<code>MASCompositeConstraint</code> 是<code>MASConstraint</code>的集合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">_childConstraints = [children mutableCopy];</div><div class="line">    for (MASConstraint *constraint in _childConstraints) &#123;</div><div class="line">        constraint.delegate = self;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>这段可以表示：<code>MASCompositeConstraint</code>是存放<code>MASConstraint</code>对象的一个集合也就是<code>_childConstraints</code>这个数组。</li>
</ul>
<h2 id="3-MASConstraint是MASCompositeConstraint和MASViewConstraint的父类。"><a href="#3-MASConstraint是MASCompositeConstraint和MASViewConstraint的父类。" class="headerlink" title="3.MASConstraint是MASCompositeConstraint和MASViewConstraint的父类。"></a>3.<code>MASConstraint</code>是<code>MASCompositeConstraint</code>和<code>MASViewConstraint</code>的父类。</h2><p> <code>MASConstraint</code>是一个抽象类，抽象类是什么？抽象类就是不能进行实例化的类，即没有具体实例对象的类。抽象类有点类似“模板”的作用，目的是根据其格式来创建和修改新的类。对象不能由抽象类直接创建，只可以通过抽象类派生出新的子类，再由其子类来创建对象。我们平时在进行开发的时候一般是用<code>Protocol</code>来达到我们想要的效果。</p>
<p>要了解抽象类可以看看<code>CAAnimation</code>，<code>CAAnimation</code>是一个典型的抽象类。实现都是通过其子类来实现。 回到正题，<code>MASConstraint</code>到底是干嘛的？其实我们就看看它的子类。<code>MASCompositeConstraint</code>和<code>MASViewConstraint</code>。</p>
<h2 id="4-MASViewConstraint。对MASViewAttribute再次封装"><a href="#4-MASViewConstraint。对MASViewAttribute再次封装" class="headerlink" title="4.MASViewConstraint。对MASViewAttribute再次封装"></a>4.<code>MASViewConstraint</code>。对<code>MASViewAttribute</code>再次封装</h2><p>  来看下他的初始化方法。就应该知道是干嘛的了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">  - (id)initWithFirstViewAttribute:(MASViewAttribute *)firstViewAttribute &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (!self) return nil;</div><div class="line">    </div><div class="line">    _firstViewAttribute = firstViewAttribute;</div><div class="line">    self.layoutPriority = MASLayoutPriorityRequired;</div><div class="line">    self.layoutMultiplier = 1;</div><div class="line">    </div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这个初始化方法就传入了一个<code>MASViewAttribute</code>对象。然后保存了下来，后面会用到这个对象。</li>
<li>并且把约束加到所在<code>view</code>上时候，也都是通过<code>MASViewConstraint.m</code>中的<strong>-(void)<install></install></strong>这个方法中。后面我们举例的时候也会看到这个方法。</li>
</ul>
<h2 id="5-MASConstraintMaker"><a href="#5-MASConstraintMaker" class="headerlink" title="5. MASConstraintMaker"></a>5. MASConstraintMaker</h2><p>一个工厂类，用来创建不同类型的<strong>MASConstraint</strong>。主要就是提<br>供方法用来对<code>view</code>添加约束。在我们在对<code>view</code>进行约束的时候，往往是用这种方法来添加约束的。</p>
<pre><code>[backGroundImage mas_makeConstraints:^(MASConstraintMaker *make) {
    make.left.equalTo(@20.0f);
    make.right.equalTo(@20.0f);
}];
</code></pre><ul>
<li>该<code>Block</code>返回的就是<code>MASConstraintMaker</code>类型的对象，通过该对象可以设置我们想要的约束。<strong>make.left</strong>方法就是调用<strong>MASConstraintMaker</strong>中的工厂方法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)left &#123;</div><div class="line">    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeLeft];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="（二）举例看看Masonry具体是怎么样进行约束的。"><a href="#（二）举例看看Masonry具体是怎么样进行约束的。" class="headerlink" title="（二）举例看看Masonry具体是怎么样进行约束的。"></a>（二）举例看看<code>Masonry</code>具体是怎么样进行约束的。</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[backView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">    make.height.equalTo(@10.0f);</div><div class="line">    make.edges.mas_equalTo(UIEdgeInsetsMake(10.0f, 0, 10.0f, 0));</div><div class="line">    make.size.mas_equalTo(CGSizeMake(10.0, 20.0));</div><div class="line">    make.left.right.and.bottom.equalTo(superview);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>只贴了几种不同情况的约束方法，并不正确。</li>
</ul>
<h2 id="mas-makeConstraints"><a href="#mas-makeConstraints" class="headerlink" title="mas_makeConstraints"></a>mas_makeConstraints</h2><p>先看第一步。调用UIView的<code>category</code> <code>View+MASAdditions</code>中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *))block &#123;</div><div class="line">    self.translatesAutoresizingMaskIntoConstraints = NO;</div><div class="line">    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];</div><div class="line">    block(constraintMaker);</div><div class="line">    return [constraintMaker install];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>Masonry</code>已经设置了<code>translatesAutoresizingMaskIntoConstraints</code>属性为NO,即可开始通过代码添加<code>Constraint</code>,否则<code>View</code>还是会按照以往的<code>autoresizingMask</code>进行计算.</li>
<li>下面创建了一个<code>MASConstraintMaker</code>对象。传入当前view，保存当前的view，因为添加约束就是需要view的嘛！</li>
<li>通过<code>Block</code>返回<code>MASConstraintMaker</code>对象，交给用户对该对象进行配置属性。</li>
<li>最后进行<code>install</code>操作，对刚刚创建<code>MASConstraintMaker</code>对象所传入的<code>view</code>值进行约束操作。并且返回了所有约束的数组。</li>
</ul>
<p><code>View+MASAdditions</code>中还有两个方法，分别是：</p>
<pre><code>- (NSArray *)mas_updateConstraints:(void(^)(MASConstraintMaker *))block {
self.translatesAutoresizingMaskIntoConstraints = NO;
MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];
constraintMaker.updateExisting = YES;
block(constraintMaker);
return [constraintMaker install];
}

- (NSArray *)mas_remakeConstraints:(void(^)(MASConstraintMaker *make))block {
self.translatesAutoresizingMaskIntoConstraints = NO;
MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];
constraintMaker.removeExisting = YES;
block(constraintMaker);
return [constraintMaker install];
}
</code></pre><p>看方法名可以看出来，分别的作用应该是，更新和重新添加约束。主要的区别就是分别对<code>MASConstraintMaker</code>对象分别设置了<code>updateExisting</code>和<code>removeExisting</code>为<code>YES</code>。这两个属性最后在``添加约束的时候用到。</p>
<ul>
<li>updateExisting为<code>YES</code>的时候，<code>[constraintMaker install]</code>执行的时候，会将这个值赋给<code>MASConstraint</code>对象。<br>`for (MASConstraint *constraint in constraints) {<pre><code>constraint.updateExisting = self.updateExisting;
[constraint install];
</code></pre>  }<br>`</li>
</ul>
<p><code>[constraint install]</code>一条一条对<code>view</code>配置约束。进到这个<code>install</code>方法中，用到<code>updateExisting</code>这个属性的地方：<br>`MASLayoutConstraint *existingConstraint = nil;</p>
<pre><code>if (self.updateExisting) {
    existingConstraint = [self layoutConstraintSimilarTo:layoutConstraint];
}
if (existingConstraint) {
    // just update the constant
    existingConstraint.constant = layoutConstraint.constant;
    self.layoutConstraint = existingConstraint;
} else {
    [self.installedView addConstraint:layoutConstraint];
    self.layoutConstraint = layoutConstraint;
    [firstLayoutItem.mas_installedConstraints addObject:self];
}
</code></pre><p><code>最后的目的就是，如果检查是否存在这个约束，如果当前</code>view`存在这条约束，就更新该约束。没有就添加约束。</p>
<ul>
<li><p><code>removeExisting</code>设置为<code>YES</code>时，在<code>[constraintMaker install]</code>方法中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if (self.removeExisting) &#123;</div><div class="line">       NSArray *installedConstraints = [MASViewConstraint installedConstraintsForView:self.view];</div><div class="line">       for (MASConstraint *constraint in installedConstraints) &#123;</div><div class="line">           [constraint uninstall];</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>移除所有的约束，添加新的约束。</p>
<blockquote>
<p>make.height.equalTo(@10.0f);</p>
</blockquote>
<p>调用链为：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"> - (MASConstraint *)height &#123;</div><div class="line">    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeHeight];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    return [self constraint:nil addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">&#125;</div><div class="line"></div><div class="line"> - (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:self.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    if ([constraint isKindOfClass:MASViewConstraint.class]) &#123;</div><div class="line">        //replace with composite constraint</div><div class="line">        NSArray *children = @[constraint, newConstraint];</div><div class="line">        MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">        compositeConstraint.delegate = self;</div><div class="line">        [self constraint:constraint shouldBeReplacedWithConstraint:compositeConstraint];</div><div class="line">        return compositeConstraint;</div><div class="line">    &#125;</div><div class="line">    if (!constraint) &#123;</div><div class="line">        newConstraint.delegate = self;</div><div class="line">        [self.constraints addObject:newConstraint];</div><div class="line">    &#125;</div><div class="line">    return newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对<code>make</code>设置属性时候一般最后会跳到这个方法。除了几个特殊的属性。</p>
<p>逐步看下代码:</p>
<ul>
<li>第一句创建了<code>MASViewAttribute</code>对象。传入了<code>view</code>和<code>NSLayoutAttributeHeight</code>。分别保存了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_view = view;</div><div class="line">_item = item;</div><div class="line">_layoutAttribute = layoutAttribute;</div></pre></td></tr></table></figure>
<p> 三个值。</p>
<ul>
<li>下面创建了<code>MASViewConstraint</code>对象。传入上面创建的<code>MASViewAttribute</code>对象并保存。<br><code>if ([constraint isKindOfClass:MASViewConstraint.class])</code>这段因为<code>constraint=nil</code>略过了。当<code>make.height.width.equalTo</code>这种情况会执行。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (!constraint) &#123;</div><div class="line">        newConstraint.delegate = self;</div><div class="line">        [self.constraints addObject:newConstraint];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>为<code>MASViewConstraint</code>对象设置了代理，（这个代理有什么用，后面具体说的），并把改对象加到了数组中，用于后面的<code>install</code>。</li>
<li>最后返回<code>MASConstraint</code>对象，为进行后面的配置。返回<code>MASConstraint</code>类型对象的原因是为了后面的链式调用。并且刚刚说的设置delegate也是为了链式调用。</li>
</ul>
<h2 id="MASConstraint-equalTo-10-0f"><a href="#MASConstraint-equalTo-10-0f" class="headerlink" title="(MASConstraint*).equalTo(@10.0f)"></a>(MASConstraint*).equalTo(@10.0f)</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> - (MASConstraint * (^)(id))equalTo &#123;</div><div class="line">    return ^id(id attribute) &#123;</div><div class="line">        return self.equalToWithRelation(attribute, NSLayoutRelationEqual);</div><div class="line">        &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 继续点<code>equalToWithRelation</code>，选择选项。如果点击<code>MASConstraint</code>中的<code>equalToWithRelation</code>会执行抛出<code>MASMethodNotImplemented()</code>;这个宏。因为<code>MASConstraint</code>是抽象类，它不创建对象，只能通过它的子类来执行，就是方法不由<code>MASConstraint</code>操作，它的子类来实现方法。我们点进<code>MASViewConstraint</code>类中的<code>equalToWithRelation</code>方法。方法：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"> - (MASConstraint * (^)(id, NSLayoutRelation))equalToWithRelation &#123;</div><div class="line">    return ^id(id attribute, NSLayoutRelation relation) &#123;</div><div class="line">        if ([attribute isKindOfClass:NSArray.class]) &#123;</div><div class="line">            NSAssert(!self.hasLayoutRelation, @&quot;Redefinition of constraint relation&quot;);</div><div class="line">            NSMutableArray *children = NSMutableArray.new;</div><div class="line">            for (id attr in attribute) &#123;</div><div class="line">                MASViewConstraint *viewConstraint = [self copy];</div><div class="line">                viewConstraint.secondViewAttribute = attr;</div><div class="line">                [children addObject:viewConstraint];</div><div class="line">            &#125;</div><div class="line">            MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">            compositeConstraint.delegate = self.delegate;</div><div class="line">            [self.delegate constraint:self shouldBeReplacedWithConstraint:compositeConstraint];</div><div class="line">            return compositeConstraint;</div><div class="line">        &#125; else &#123;</div><div class="line">            NSAssert(!self.hasLayoutRelation || self.layoutRelation == relation &amp;&amp; [attribute isKindOfClass:NSValue.class], @&quot;Redefinition of constraint relation&quot;);</div><div class="line">            self.layoutRelation = relation;</div><div class="line">            self.secondViewAttribute = attribute;</div><div class="line">            return self;</div><div class="line">        &#125;</div><div class="line">      &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>if ([attribute isKindOfClass:NSArray.class])</code>在<code>(MASConstraint*).equalTo(@[view,view])</code>的时候成立，最后返回的是<code>MASCompositeConstraint</code>对象，里面包含了约束数组。并且设置的<code>delegate</code>，一样为了链式调用</li>
<li><code>else</code>中针对于单个约束操作，两个赋值操作。<code>self.layoutRelation</code>和<code>self.secondViewAttribute</code>都重写的<code>set</code>方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)setLayoutRelation:(NSLayoutRelation)layoutRelation &#123;</div><div class="line">    _layoutRelation = layoutRelation;</div><div class="line">    self.hasLayoutRelation = YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>保存了约束关系<code>NSLayoutRelationEqual</code>。<code>hasLayoutRelation</code>设置<code>YES</code>，说明已经有约束关系。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)setSecondViewAttribute:(id)secondViewAttribute &#123;</div><div class="line">    if ([secondViewAttribute isKindOfClass:NSValue.class]) &#123;</div><div class="line">        [self setLayoutConstantWithValue:secondViewAttribute];</div><div class="line">    &#125; else if ([secondViewAttribute isKindOfClass:MAS_VIEW.class]) &#123;</div><div class="line">        _secondViewAttribute = [[MASViewAttribute alloc] initWithView:secondViewAttribute layoutAttribute:self.firstViewAttribute.layoutAttribute];</div><div class="line">    &#125; else if ([secondViewAttribute isKindOfClass:MASViewAttribute.class]) &#123;</div><div class="line">        _secondViewAttribute = secondViewAttribute;</div><div class="line">    &#125; else &#123;</div><div class="line">        NSAssert(NO, @&quot;attempting to add unsupported attribute: %@&quot;, secondViewAttribute);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>重写<code>secondViewAttribute</code>方法。针对于<code>equalTo(self)</code>的参数类型做判断。</p>
<p> 第一个是一个<code>NSValue</code>类型的。也就是equalTo(@10.0f)。查看调用链。最后得到<code>_layoutConstant</code> 和<code>self.layoutConstraint.constant</code>最后调用约束<code>install</code>时会用到。<br>第二个是一个<code>view</code>类型。也就是<code>equalTo(self)</code>或者<code>equalTo(view)</code>这几种情况。然后会创建一个与<code>firstViewAttribute</code>持有相同<code>layoutAttribute</code>属性的<code>MASViewAttribute</code>的对象。相当于使要约束的对象的<code>height</code>于被约束的对象的<code>height</code>相等。<br>第三种是<code>MASViewAttribute</code>类型，例如：equalTo(self.height)直接复制给<code>_secondViewAttribute</code>，跟第二种意思差不多。</p>
</li>
</ul>
<p><code>- (void)setLayoutConstantWithValue:(NSValue *)value</code>方法会判断<code>Value</code>类型，这种情况会走到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if ([value isKindOfClass:NSNumber.class]) &#123;</div><div class="line">        self.offset = [(NSNumber *)value doubleValue];</div></pre></td></tr></table></figure>
<h2 id="make-edges-mas-equalTo-UIEdgeInsetsMake-10-0f-0-10-0f-0"><a href="#make-edges-mas-equalTo-UIEdgeInsetsMake-10-0f-0-10-0f-0" class="headerlink" title="make.edges.mas_equalTo(UIEdgeInsetsMake(10.0f, 0, 10.0f, 0));"></a>make.edges.mas_equalTo(UIEdgeInsetsMake(10.0f, 0, 10.0f, 0));</h2><p>调用链：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)edges &#123;</div><div class="line">    return [self addConstraintWithAttributes:MASAttributeTop | MASAttributeLeft | MASAttributeRight | MASAttributeBottom];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)addConstraintWithAttributes:(MASAttribute)attrs &#123;</div><div class="line">    __unused MASAttribute anyAttribute = (MASAttributeLeft | MASAttributeRight | MASAttributeTop | MASAttributeBottom | MASAttributeLeading..............);</div><div class="line">    </div><div class="line">    NSAssert((attrs &amp; anyAttribute) != 0, @&quot;You didn&apos;t pass any attribute to make.attributes(...)&quot;);</div><div class="line">    </div><div class="line">    NSMutableArray *attributes = [NSMutableArray array];</div><div class="line">    </div><div class="line">    if (attrs &amp; MASAttributeLeft) [attributes addObject:self.view.mas_left];</div><div class="line"></div><div class="line">    </div><div class="line">#if (__IPHONE_OS_VERSION_MIN_REQUIRED &gt;= 80000) || (__TV_OS_VERSION_MIN_REQUIRED &gt;= 9000) || (__MAC_OS_X_VERSION_MIN_REQUIRED &gt;= 101100)</div><div class="line">    </div><div class="line">    if (attrs &amp; MASAttributeFirstBaseline) [attributes addObject:self.view.mas_firstBaseline];</div><div class="line">    if (attrs &amp; MASAttributeLastBaseline) [attributes addObject:self.view.mas_lastBaseline];</div><div class="line">    ...........................</div><div class="line">#endif</div><div class="line">    </div><div class="line">#if TARGET_OS_IPHONE || TARGET_OS_TV</div><div class="line">    </div><div class="line">    if (attrs &amp; MASAttributeLeftMargin) [attributes addObject:self.view.mas_leftMargin];</div><div class="line">......................</div><div class="line">    </div><div class="line">#endif</div><div class="line">    </div><div class="line">    NSMutableArray *children = [NSMutableArray arrayWithCapacity:attributes.count];</div><div class="line">    </div><div class="line">    for (MASViewAttribute *a in attributes) &#123;</div><div class="line">        [children addObject:[[MASViewConstraint alloc] initWithFirstViewAttribute:a]];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    MASCompositeConstraint *constraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">    constraint.delegate = self;</div><div class="line">    [self.constraints addObject:constraint];</div><div class="line">    return constraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 主要是：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">if (attrs &amp; MASAttributeLeft) [attributes addObject:self.view.mas_left];</div><div class="line">   if (attrs &amp; MASAttributeRight) [attributes addObject:self.view.mas_right];</div><div class="line">   if (attrs &amp; MASAttributeTop) [attributes addObject:self.view.mas_top];</div><div class="line">   if (attrs &amp; MASAttributeBottom) [attributes addObject:self.view.mas_bottom];</div><div class="line">   </div><div class="line">NSMutableArray *children = [NSMutableArray arrayWithCapacity:attributes.count];</div><div class="line">   </div><div class="line">   for (MASViewAttribute *a in attributes) &#123;</div><div class="line">       [children addObject:[[MASViewConstraint alloc] initWithFirstViewAttribute:a]];</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   MASCompositeConstraint *constraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">   constraint.delegate = self;</div><div class="line">   [self.constraints addObject:constraint];</div><div class="line">   return constraint;</div></pre></td></tr></table></figure>
<ul>
<li>根据<code>edges</code>加入相关<code>MASViewAttribute</code>对象进数组。通过数组中的<code>MASViewAttribute</code>对象创建<code>MASViewConstraint</code>对象加入数组。再传入该数组创建<code>MASCompositeConstraint</code>对象。设置代理，加入<code>self.constraints</code>数组待使用。再返回<code>MASCompositeConstraint</code>对象。基本步骤跟上面的<br><code>- (MASConstraint *)constraint:(MASConstraint *)constraint   addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>差不多。因为<code>edges</code>包含了多个约束，所以最后返回的是<code>MASConstraint</code>子类<code>MASCompositeConstraint</code>。上面介绍过<code>MASCompositeConstraint</code>是存放<code>MASConstraint</code>对象的一个集合也就是<code>_childConstraints</code>这个数组。</li>
</ul>
<blockquote>
<p> mas_equalTo只是对其参数进行了一个BOX操作(装箱)，</p>
</blockquote>
<pre><code>1. #define mas_equalTo(...) equalTo(MASBoxValue((__VA_ARGS__)))
2. #define MASBoxValue(value) _MASBoxValue(@encode(__typeof__((value))), (value))
3. static inline id _MASBoxValue(const char *type, ...)
</code></pre><ul>
<li><p>所做的事情基本数据类型包装成<code>NSValue</code>或者<code>NSNumber</code>。</p>
</li>
<li><p>所支持的类型 除了NSNumber支持的那些数值类型之外 就只支持<code>CGPoint</code>、 <code>CGSize</code>、<code>UIEdgeInsets</code>。<br><code>make.height.mas_equalTo(10.0f);</code> 后面就直接可以写基本数据类型了。而<code>make.height.equalTo(@10.0f);</code>需要添加<code>@</code>符号，转化成<code>NSValue</code>类型。<br>最后跟上面的情况不同。上面一种进入的是进去：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if ([value isKindOfClass:NSNumber.class]) </div><div class="line">        self.offset = [(NSNumber *)value doubleValue];</div></pre></td></tr></table></figure>
<p>而这个不是<code>NSNumber</code>类型。进入的是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (strcmp(value.objCType, @encode(MASEdgeInsets)) == 0) </div><div class="line">        MASEdgeInsets insets;</div><div class="line">        [value getValue:&amp;insets];</div><div class="line">        self.insets = insets;</div></pre></td></tr></table></figure>
<h2 id="make-size-mas-equalTo-CGSizeMake-10-0-20-0"><a href="#make-size-mas-equalTo-CGSizeMake-10-0-20-0" class="headerlink" title="make.size.mas_equalTo(CGSizeMake(10.0, 20.0));"></a>make.size.mas_equalTo(CGSizeMake(10.0, 20.0));</h2><ul>
<li>具体调用链跟上面一种情况相似。也是最后一步进入的是：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (strcmp(value.objCType, @encode(CGSize)) == 0) &#123;</div><div class="line">        CGSize size;</div><div class="line">        [value getValue:&amp;size];</div><div class="line">        self.sizeOffset = size;</div></pre></td></tr></table></figure>
<h2 id="make-left-right-and-bottom-equalTo-superview"><a href="#make-left-right-and-bottom-equalTo-superview" class="headerlink" title="make.left.right.and.bottom.equalTo(superview);"></a>make.left.right.and.bottom.equalTo(superview);</h2><ul>
<li>.left调用链：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MASConstraintMaker.m</div><div class="line">- (MASConstraint *)left &#123;</div><div class="line">    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeLeft];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MASConstraintMaker.m</div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    return [self constraint:nil addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">MASConstraintMaker.m</div><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:self.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    .....</div><div class="line">    if (!constraint) &#123;</div><div class="line">        newConstraint.delegate = self;</div><div class="line">        [self.constraints addObject:newConstraint];</div><div class="line">    &#125;</div><div class="line">    return newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>跟上面调用顺序一样。返回后执行<code>.right</code>，调用顺序为：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">MASConstraint.m</div><div class="line"></div><div class="line">- (MASConstraint *)right &#123;</div><div class="line">    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeRight];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MASViewConstraint.m</div><div class="line"></div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    NSAssert(!self.hasLayoutRelation, @&quot;Attributes should be chained before defining the constraint relation&quot;);</div><div class="line"></div><div class="line">    return [self.delegate constraint:self addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:self.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    if ([constraint isKindOfClass:MASViewConstraint.class]) &#123;</div><div class="line">        //replace with composite constraint</div><div class="line">        NSArray *children = @[constraint, newConstraint];</div><div class="line">        MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</div><div class="line">        compositeConstraint.delegate = self;</div><div class="line">        [self constraint:constraint shouldBeReplacedWithConstraint:compositeConstraint];</div><div class="line">        return compositeConstraint;</div><div class="line">    &#125;</div><div class="line">..........</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>因为<code>return [self.delegate constraint:self addConstraintWithLayoutAttribute:layoutAttribute]</code><br><code>constraint</code>参数的<code>self</code>也就是<code>MASViewConstraint</code>。所以走进<code>if</code>判断，然后把<code>left</code>和<code>right</code>加到<code>children</code>数组中，并创建<code>MASCompositeConstraint</code>约束集合对象，设置代理。并把先前的约束对象替换成了<code>MASCompositeConstraint</code>对象。<code>self.constraints</code>最后只有一个<code>MASCompositeConstraint</code>对象的约束集合。</p>
</li>
<li><p><code>.and.bottom</code>调用顺序：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MASConstraint.m</div><div class="line">- (MASConstraint *)and &#123;</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MASConstraint.m</div><div class="line">- (MASConstraint *)bottom &#123;</div><div class="line">    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeBottom];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">MASCompositeConstraint.m</div><div class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    [self constraint:self addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MASCompositeConstraint.m</div><div class="line">- (MASConstraint *)constraint:(MASConstraint __unused *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    id&lt;MASConstraintDelegate&gt; strongDelegate = self.delegate;</div><div class="line">    MASConstraint *newConstraint = [strongDelegate constraint:self addConstraintWithLayoutAttribute:layoutAttribute];</div><div class="line">    newConstraint.delegate = self;</div><div class="line">    [self.childConstraints addObject:newConstraint];</div><div class="line">    return newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MASConstraintMaker.m</div><div class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</div><div class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:self.view layoutAttribute:layoutAttribute];</div><div class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</div><div class="line">    .............</div><div class="line">    return newConstraint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>最后只返回一个<code>MASViewConstraint</code>类型的对象。最后再调用上面方法中的，设置代理并把约束添加到数组中保存：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">newConstraint.delegate = self;</div><div class="line">[self.childConstraints addObject:newConstraint];</div></pre></td></tr></table></figure>
<h2 id="equalTo-superview"><a href="#equalTo-superview" class="headerlink" title="equalTo(superview)"></a>equalTo(superview)</h2><ul>
<li><p>过程跟上面一样，不做阐述。</p>
<p> 最后执行<code>return [constraintMaker install];</code><br><code>make.height.equalTo(@10.0f)</code>这条约束的<code>install</code>调用链为：其他三条约束<code>make.height.equalTo(@10.0f);
  make.edges.mas_equalTo(UIEdgeInsetsMake(10.0f, 0, 10.0f, 0));
  make.size.mas_equalTo(CGSizeMake(10.0, 20.0));
  make.left.right.and.bottom.equalTo(superview);</code>在下面<code>install</code>之后多了一步:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MASCompositeConstraint.m</div><div class="line">- (void)install &#123;</div><div class="line">    for (MASConstraint *constraint in self.childConstraints) &#123;</div><div class="line">        constraint.updateExisting = self.updateExisting;</div><div class="line">        [constraint install];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>因为<code>edges</code>和<code>size</code>和<code>.left.right.and.bottom</code>都不是单一约束类型。而是一个组合，例如<code>size</code>是<code>width</code>和<code>height</code>的组合。<code>MASCompositeConstraint</code>是保存约束的组合，所以在<code>MASConstraintMaker.m</code>中的<code>install</code>方法中会调用子类<code>MASCompositeConstraint</code>类的中的<code>install</code>方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">MASConstraintMaker.m</div><div class="line">- (NSArray *)install &#123;</div><div class="line">    ..........</div><div class="line">    NSArray *constraints = self.constraints.copy;</div><div class="line">    for (MASConstraint *constraint in constraints) &#123;</div><div class="line">        constraint.updateExisting = self.updateExisting;</div><div class="line">        [constraint install];</div><div class="line">    &#125;</div><div class="line">    [self.constraints removeAllObjects];</div><div class="line">    return constraints;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>遍历保存约束对象的数组。依次执行<code>MASConstraint</code>的<code>install</code>方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">MASViewConstraint.m</div><div class="line">- (void)install &#123;</div><div class="line">    if (self.hasBeenInstalled) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    if ([self supportsActiveProperty] &amp;&amp; self.layoutConstraint) &#123;</div><div class="line">        self.layoutConstraint.active = YES;</div><div class="line">        [self.firstViewAttribute.view.mas_installedConstraints addObject:self];</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    MAS_VIEW *firstLayoutItem = self.firstViewAttribute.item;</div><div class="line">    NSLayoutAttribute firstLayoutAttribute = self.firstViewAttribute.layoutAttribute;</div><div class="line">    MAS_VIEW *secondLayoutItem = self.secondViewAttribute.item;</div><div class="line">    NSLayoutAttribute secondLayoutAttribute = self.secondViewAttribute.layoutAttribute;</div><div class="line"></div><div class="line">    // alignment attributes must have a secondViewAttribute</div><div class="line">    // therefore we assume that is refering to superview</div><div class="line">    // eg make.left.equalTo(@10)</div><div class="line">    if (!self.firstViewAttribute.isSizeAttribute &amp;&amp; !self.secondViewAttribute) &#123;</div><div class="line">        secondLayoutItem = self.firstViewAttribute.view.superview;</div><div class="line">        secondLayoutAttribute = firstLayoutAttribute;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    MASLayoutConstraint *layoutConstraint</div><div class="line">        = [MASLayoutConstraint constraintWithItem:firstLayoutItem</div><div class="line">                                        attribute:firstLayoutAttribute</div><div class="line">                                        relatedBy:self.layoutRelation</div><div class="line">                                           toItem:secondLayoutItem</div><div class="line">                                        attribute:secondLayoutAttribute</div><div class="line">                                       multiplier:self.layoutMultiplier</div><div class="line">                                         constant:self.layoutConstant];</div><div class="line">    </div><div class="line">    layoutConstraint.priority = self.layoutPriority;</div><div class="line">    layoutConstraint.mas_key = self.mas_key;</div><div class="line">    </div><div class="line">    if (self.secondViewAttribute.view) &#123;</div><div class="line">        MAS_VIEW *closestCommonSuperview = [self.firstViewAttribute.view mas_closestCommonSuperview:self.secondViewAttribute.view];</div><div class="line">        NSAssert(closestCommonSuperview,</div><div class="line">                 @&quot;couldn&apos;t find a common superview for %@ and %@&quot;,</div><div class="line">                 self.firstViewAttribute.view, self.secondViewAttribute.view);</div><div class="line">        self.installedView = closestCommonSuperview;</div><div class="line">    &#125; else if (self.firstViewAttribute.isSizeAttribute) &#123;</div><div class="line">        self.installedView = self.firstViewAttribute.view;</div><div class="line">    &#125; else &#123;</div><div class="line">        self.installedView = self.firstViewAttribute.view.superview;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    MASLayoutConstraint *existingConstraint = nil;</div><div class="line">    if (self.updateExisting) &#123;</div><div class="line">        existingConstraint = [self layoutConstraintSimilarTo:layoutConstraint];</div><div class="line">    &#125;</div><div class="line">    if (existingConstraint) &#123;</div><div class="line">        // just update the constant</div><div class="line">        existingConstraint.constant = layoutConstraint.constant;</div><div class="line">        self.layoutConstraint = existingConstraint;</div><div class="line">    &#125; else &#123;</div><div class="line">        [self.installedView addConstraint:layoutConstraint];</div><div class="line">        self.layoutConstraint = layoutConstraint;</div><div class="line">        [firstLayoutItem.mas_installedConstraints addObject:self];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>逐步分析，</li>
</ul>
<figure class="highlight plain"><figcaption><span>(self.hasBeenInstalled) &#123;</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    return;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果存在了当前约束并且处于<code>Active</code>状态直接返回。</p>
<ul>
<li><code>if ([self supportsActiveProperty] &amp;&amp; self.layoutConstraint)</code>该约束是否响应<code>isActive</code>方法并且约束存在，则激活该约束并将该约束添加到<code>mas_installedConstraints</code>中，当我们执行<code>View+MASAdditions</code>中的<code>mas_remakeConstraints</code>方法时候获取mas_installedConstraints对象，执行<code>uninstall</code>方法，去删除约束。</li>
<li><code>if (!self.firstViewAttribute.isSizeAttribute &amp;&amp; !self.secondViewAttribute)</code>只有一个约束，并且该约束是设置<code>NSLayoutAttributeWidth</code>或者<code>NSLayoutAttributeHeight</code>的。设置<code>item</code>为该<code>view</code>的<code>superView</code>以及<code>secondLayoutAttribute</code>为第一个约束。也就是约束设置在第一个<code>view</code>的<code>superView</code>上。</li>
<li>根据上面的创建的对象继续创建<code>MASLayoutConstraint</code>类型的对象。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">if (self.secondViewAttribute.view) &#123;</div><div class="line">    MAS_VIEW *closestCommonSuperview = [self.firstViewAttribute.view mas_closestCommonSuperview:self.secondViewAttribute.view];</div><div class="line">    NSAssert(closestCommonSuperview,</div><div class="line">             @&quot;couldn&apos;t find a common superview for %@ and %@&quot;,</div><div class="line">             self.firstViewAttribute.view, self.secondViewAttribute.view);</div><div class="line">    self.installedView = closestCommonSuperview;</div><div class="line">&#125; else if (self.firstViewAttribute.isSizeAttribute) &#123;</div><div class="line">    self.installedView = self.firstViewAttribute.view;</div><div class="line">&#125; else &#123;</div><div class="line">    self.installedView = self.firstViewAttribute.view.superview;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>首先判断第二个约束的<code>view</code>是否存在，存在就取它们共同的<code>view</code>为约束<code>view</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">MASLayoutConstraint *existingConstraint = nil;</div><div class="line">    if (self.updateExisting) &#123;</div><div class="line">        existingConstraint = [self layoutConstraintSimilarTo:layoutConstraint];</div><div class="line">    &#125;</div><div class="line">    if (existingConstraint) &#123;</div><div class="line">        // just update the constant</div><div class="line">        existingConstraint.constant = layoutConstraint.constant;</div><div class="line">        self.layoutConstraint = existingConstraint;</div><div class="line">    &#125; else &#123;</div><div class="line">        [self.installedView addConstraint:layoutConstraint];</div><div class="line">        self.layoutConstraint = layoutConstraint;</div><div class="line">        [firstLayoutItem.mas_installedConstraints addObject:self];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>判断是否是更新约束即：<code>View+MASAdditions</code>中的<code>mas_updateConstraints</code>方法<code>updateExisting</code>为<code>YES</code>。执行更新已经有的约束。不去重新添加。<code>else</code>去添加约束。并把约束添加数组。当<code>uninstall</code>会获取该数组。以删除约束。</p>
</li>
<li><p>到这一步添加约束的操作也就完成了。下面我们以<code>make.left.right.and.bottom.equalTo(superview);</code>为例子看看 <code>Masonry</code>中的链式语法。</p>
</li>
</ul>
<h1 id="End-Masonry中的链式语法"><a href="#End-Masonry中的链式语法" class="headerlink" title="End:Masonry中的链式语法"></a>End:Masonry中的链式语法</h1><p>Masonry中的主要是依靠</p>
<ul>
<li><code>- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>返回的类型，返回<code>MASConstraint</code>就可以继续使用点语法去设置属性。</li>
<li>对MASConstraint子类对象设置<code>delegate</code>。最后代理方法都是<code>- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>这个方法。反复这个过程。每次该方法返回的都是<code>MASConstraint</code>对象。就可以实现链式语法。</li>
</ul>
<h2 id="make-left第一步就是调用MASConstraintMaker中的-MASConstraint-constraint-MASConstraint-constraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。返回MASConstraint类型对象。"><a href="#make-left第一步就是调用MASConstraintMaker中的-MASConstraint-constraint-MASConstraint-constraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。返回MASConstraint类型对象。" class="headerlink" title="make.left第一步就是调用MASConstraintMaker中的- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute方法。返回MASConstraint类型对象。"></a><code>make.left</code>第一步就是调用<code>MASConstraintMaker</code>中的<code>- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>方法。返回<code>MASConstraint</code>类型对象。</h2><h2 id="MASConstraint-right调用MASConstraint-m中的-MASConstraint-right，再调用MASViewConstraint中的-MASConstraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute，该方法只调用了代理方法。即是，第一步中的MASConstraintMaker的方法。"><a href="#MASConstraint-right调用MASConstraint-m中的-MASConstraint-right，再调用MASViewConstraint中的-MASConstraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute，该方法只调用了代理方法。即是，第一步中的MASConstraintMaker的方法。" class="headerlink" title="(MASConstraint *).right调用MASConstraint.m中的- (MASConstraint *)right，再调用MASViewConstraint中的- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute，该方法只调用了代理方法。即是，第一步中的MASConstraintMaker的方法。"></a><code>(MASConstraint *).right</code>调用<code>MASConstraint.m</code>中的<code>- (MASConstraint *)right</code>，再调用<code>MASViewConstraint</code>中的<code>- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>，该方法只调用了代理方法。即是，第一步中的<code>MASConstraintMaker</code>的方法。</h2><h2 id="and实际没什么操作，只返回本身。跟with意思一样，为了方便好看吧！"><a href="#and实际没什么操作，只返回本身。跟with意思一样，为了方便好看吧！" class="headerlink" title=".and实际没什么操作，只返回本身。跟with意思一样，为了方便好看吧！"></a><code>.and</code>实际没什么操作，只返回本身。跟<code>with</code>意思一样，为了方便好看吧！</h2><h2 id="bottom调用MASConstraint-m中的-MASConstraint-bottom方法。上面说过。在-right这步时返回的是一个MASCompositeConstraint对象的约束数组。所以下面进入的是MASCompositeConstraint中的-MASConstraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。再调用-MASConstraint-constraint-MASConstraint-unused-constraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。同样也是去执行代理方法，实现在MASConstraintMaker-m中。这时只返回MASViewConstraint-对象。添加进数组。作后面install操作。最后同样是返回MASConstraint对象，可以继续设置属性，进行链式语法。"><a href="#bottom调用MASConstraint-m中的-MASConstraint-bottom方法。上面说过。在-right这步时返回的是一个MASCompositeConstraint对象的约束数组。所以下面进入的是MASCompositeConstraint中的-MASConstraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。再调用-MASConstraint-constraint-MASConstraint-unused-constraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。同样也是去执行代理方法，实现在MASConstraintMaker-m中。这时只返回MASViewConstraint-对象。添加进数组。作后面install操作。最后同样是返回MASConstraint对象，可以继续设置属性，进行链式语法。" class="headerlink" title=".bottom调用MASConstraint.m中的- (MASConstraint *)bottom方法。上面说过。在.right这步时返回的是一个MASCompositeConstraint对象的约束数组。所以下面进入的是MASCompositeConstraint中的- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute方法。再调用- (MASConstraint *)constraint:(MASConstraint __unused *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute方法。同样也是去执行代理方法，实现在MASConstraintMaker.m中。这时只返回MASViewConstraint*对象。添加进数组。作后面install操作。最后同样是返回MASConstraint对象，可以继续设置属性，进行链式语法。"></a><code>.bottom</code>调用<code>MASConstraint.m</code>中的<code>- (MASConstraint *)bottom</code>方法。上面说过。在<code>.right</code>这步时返回的是一个<code>MASCompositeConstraint</code>对象的约束数组。所以下面进入的是<code>MASCompositeConstraint</code>中的<code>- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>方法。再调用<code>- (MASConstraint *)constraint:(MASConstraint __unused *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute</code>方法。同样也是去执行代理方法，实现在<code>MASConstraintMaker.m</code>中。这时只返回<code>MASViewConstraint*</code>对象。添加进数组。作后面<code>install</code>操作。最后同样是返回<code>MASConstraint</code>对象，可以继续设置属性，进行链式语法。</h2><h2 id="关于equalTo-superview-的链式语法。"><a href="#关于equalTo-superview-的链式语法。" class="headerlink" title="关于equalTo(superview)的链式语法。"></a>关于<code>equalTo(superview)</code>的链式语法。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (MASConstraint * (^)(id))equalTo &#123;</div><div class="line">    return ^id(id attribute) &#123;</div><div class="line">        return self.equalToWithRelation(attribute, NSLayoutRelationEqual);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>方法后面跟括号，一般想到的就是<code>Block</code>，<code>Block</code>是带有变量的匿名函数。可以返回值，看上面的方法，<code>Block</code>返回的都是当前实例的本身，也就是抽象类<code>MASConstraint</code>。返回该实例对象就可以继续进行点语法，链式语法。顺便写了一个相识的方法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (Person *(^)(NSString *str))eat9 &#123;</div><div class="line">    return ^(NSString *str) &#123;</div><div class="line">        //对&quot;str&quot;进行操作即可</div><div class="line">        return self;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>自己写一遍，就知道什么原理了，方便简洁，不需要太多的[]。</p>
<p>最后文章加深自己对此工具的认识，记录下来如果有地方说的不对，欢迎拍砖指错，谢谢！</p>
<p>参考链接有我朋友的简书哦。文章不错，可以去瞅瞅哟！</p>
<p>参考链接：</p>
<p><a href="http://www.cnblogs.com/ludashi/p/5591572.html" target="_blank" rel="external">http://www.cnblogs.com/ludashi/p/5591572.html</a></p>
<p><a href="http://www.jianshu.com/p/3fce11e370b1" target="_blank" rel="external">http://www.jianshu.com/p/3fce11e370b1</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/19/2017-3-15/" rel="prev" title="理解Run Loop">
                理解Run Loop <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="guodajiang" />
          <p class="site-author-name" itemprop="name">guodajiang</p>
          <p class="site-description motion-element" itemprop="description">好好学习，天天向上</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Masonry工具的结构及各个类的大概的作用。"><span class="nav-number">1.</span> <span class="nav-text">Masonry工具的结构及各个类的大概的作用。</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-MASViewAttribute-先看下类结构。"><span class="nav-number">1.1.</span> <span class="nav-text">1.MASViewAttribute 先看下类结构。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-MASCompositeConstraint-是MASConstraint的集合"><span class="nav-number">1.2.</span> <span class="nav-text">2.MASCompositeConstraint 是MASConstraint的集合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-MASConstraint是MASCompositeConstraint和MASViewConstraint的父类。"><span class="nav-number">1.3.</span> <span class="nav-text">3.MASConstraint是MASCompositeConstraint和MASViewConstraint的父类。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-MASViewConstraint。对MASViewAttribute再次封装"><span class="nav-number">1.4.</span> <span class="nav-text">4.MASViewConstraint。对MASViewAttribute再次封装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-MASConstraintMaker"><span class="nav-number">1.5.</span> <span class="nav-text">5. MASConstraintMaker</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#（二）举例看看Masonry具体是怎么样进行约束的。"><span class="nav-number">2.</span> <span class="nav-text">（二）举例看看Masonry具体是怎么样进行约束的。</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mas-makeConstraints"><span class="nav-number">2.1.</span> <span class="nav-text">mas_makeConstraints</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MASConstraint-equalTo-10-0f"><span class="nav-number">2.2.</span> <span class="nav-text">(MASConstraint*).equalTo(@10.0f)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#make-edges-mas-equalTo-UIEdgeInsetsMake-10-0f-0-10-0f-0"><span class="nav-number">2.3.</span> <span class="nav-text">make.edges.mas_equalTo(UIEdgeInsetsMake(10.0f, 0, 10.0f, 0));</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#make-size-mas-equalTo-CGSizeMake-10-0-20-0"><span class="nav-number">2.4.</span> <span class="nav-text">make.size.mas_equalTo(CGSizeMake(10.0, 20.0));</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#make-left-right-and-bottom-equalTo-superview"><span class="nav-number">2.5.</span> <span class="nav-text">make.left.right.and.bottom.equalTo(superview);</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#equalTo-superview"><span class="nav-number">2.6.</span> <span class="nav-text">equalTo(superview)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#End-Masonry中的链式语法"><span class="nav-number">3.</span> <span class="nav-text">End:Masonry中的链式语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#make-left第一步就是调用MASConstraintMaker中的-MASConstraint-constraint-MASConstraint-constraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。返回MASConstraint类型对象。"><span class="nav-number">3.1.</span> <span class="nav-text">make.left第一步就是调用MASConstraintMaker中的- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute方法。返回MASConstraint类型对象。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MASConstraint-right调用MASConstraint-m中的-MASConstraint-right，再调用MASViewConstraint中的-MASConstraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute，该方法只调用了代理方法。即是，第一步中的MASConstraintMaker的方法。"><span class="nav-number">3.2.</span> <span class="nav-text">(MASConstraint *).right调用MASConstraint.m中的- (MASConstraint *)right，再调用MASViewConstraint中的- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute，该方法只调用了代理方法。即是，第一步中的MASConstraintMaker的方法。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#and实际没什么操作，只返回本身。跟with意思一样，为了方便好看吧！"><span class="nav-number">3.3.</span> <span class="nav-text">.and实际没什么操作，只返回本身。跟with意思一样，为了方便好看吧！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bottom调用MASConstraint-m中的-MASConstraint-bottom方法。上面说过。在-right这步时返回的是一个MASCompositeConstraint对象的约束数组。所以下面进入的是MASCompositeConstraint中的-MASConstraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。再调用-MASConstraint-constraint-MASConstraint-unused-constraint-addConstraintWithLayoutAttribute-NSLayoutAttribute-layoutAttribute方法。同样也是去执行代理方法，实现在MASConstraintMaker-m中。这时只返回MASViewConstraint-对象。添加进数组。作后面install操作。最后同样是返回MASConstraint对象，可以继续设置属性，进行链式语法。"><span class="nav-number">3.4.</span> <span class="nav-text">.bottom调用MASConstraint.m中的- (MASConstraint *)bottom方法。上面说过。在.right这步时返回的是一个MASCompositeConstraint对象的约束数组。所以下面进入的是MASCompositeConstraint中的- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute方法。再调用- (MASConstraint *)constraint:(MASConstraint __unused *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute方法。同样也是去执行代理方法，实现在MASConstraintMaker.m中。这时只返回MASViewConstraint*对象。添加进数组。作后面install操作。最后同样是返回MASConstraint对象，可以继续设置属性，进行链式语法。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于equalTo-superview-的链式语法。"><span class="nav-number">3.5.</span> <span class="nav-text">关于equalTo(superview)的链式语法。</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">guodajiang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


</body>
</html>
